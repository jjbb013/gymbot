# 项目计划：Telegram 健身记录机器人 (GymBot)

## 1. 项目概述

开发一个 Telegram 机器人,用于自动识别和统计聊天群组中特定格式的健身训练数据.机器人需要能够理解上下文,智能解析缩写信息,并提供数据汇总和分析功能,旨在帮助用户无缝追踪个人及团队的训练进度.

## 2. 核心需求 (用户提出)

### 2.1. 自动消息解析与上下文理解
- **完整格式**: 机器人必须能解析格式为 `[训练项目] [+/-负重]kg [次数]` 的消息. 例如: `杠铃卧推 50kg 10` 或 `助力引体向上 -37kg 10`.
- **上下文关联**: 机器人需要具备记忆功能,以处理后续的简化信息.
  - **省略项目**: 当用户发送 `60kg 10` 时,机器人应理解为训练项目与上一条记录相同 (杠铃卧推),只更新负重和次数.
  - **仅记录次数**: 当用户发送 `12` 时,机器人应理解为项目和负重均与上一条记录相同,只更新次数.
- **数据归属**: 每条记录都需要与发送该消息的用户 ID 和发送时间戳关联起来.

### 2.2. 数据存储
- **训练数据**: 需要一个简单的数据库来持久化存储所有解析后的训练数据,至少包含以下字段:
  - `user_id` (用户ID)
  - `chat_id` (群组ID)
  - `exercise_name` (训练项目)
  - `weight_kg` (负重)
  - `reps` (次数)
  - `timestamp` (记录时间)
- **身体数据**: 为身体指标创建一张独立的表,包含字段:
  - `user_id` (用户ID)
  - `metric_type` (指标类型, 如: '体重', '体脂率')
  - `value` (数值)
  - `unit` (单位, 如: 'kg', '%')
  - `timestamp` (记录时间)

### 2.3. 定期汇总
- 机器人应能自动生成并发送定期报告 (例如,周报或月报) 到群组中.
- 报告应汇总这段时间内所有成员的训练数据和身体数据的变化情况.

### 2.4. 身体数据记录与追踪 (新增功能)
- **便捷记录**: 用户可通过发送特定格式的消息来记录身体数据, 例如: `体重 75kg`, `体脂率 15%`.
- **数据识别**: 机器人能自动识别关键词 (如"体重", "体脂") 并保存相关数值.
- **可扩展的指标管理**: (新增) 管理员可以通过特定命令自定义、添加或删除可追踪的身体数据指标 (如“臂围”、“腰围”等), 使系统更具灵活性.

## 3. 扩展功能与创意构想

### 3.1. 丰富的用户交互命令
- **`/start` & `/help`**: 提供欢迎信息和详细的指令说明,解释如何正确格式化健身数据.
- **`/summary [day|week|month]`**: 用户可以手动触发数据汇总,并指定时间范围 (当天/本周/本月).
- **`/my_stats [exercise_name]`**: 用户可以查询自己某个特定项目的训练历史和最佳成绩 (PR).
- **`/my_body_stats`**: (新增) 查询个人历史身体数据,如体重、体脂率变化.
- **`/group_stats [exercise_name]`**: 查询群组内某个特定项目的训练数据排行.
- **`/delete_last`**: 提供一个撤销功能,允许用户删除自己发送的上一条错误记录.
- **`/set_alias [项目名] [别名]`**: 允许用户为复杂的训练项目设置别名,例如 `/set_alias 杠铃卧推 bp`, 之后用户可以直接输入 `bp 50kg 10`.

#### 3.1.1. 管理员命令 (新增)
- **`/add_metric [指标名称] [单位]`**: 添加一个新的可追踪身体指标, 例如: `/add_metric 臂围 cm`.
- **`/list_metrics`**: 列出当前所有已配置的身体指标.
- **`/delete_metric [指标名称]`**: 删除一个已配置的身体指标.

### 3.2. 数据分析与可视化
- **个人记录 (PR) 提醒**: 当用户某项训练的负重或次数超过历史最佳时,机器人自动发送祝贺消息.
- **训练量统计**: 自动计算总训练量 (总负重 = Σ(负重 * 次数 * 组数)),并进行排名.
- **图表可视化 (可分享图片)**: 为了更直观地展示训练成果并方便分享,机器人将集成图表生成功能 (例如, 通过 QuickChart.io API). 用户可以通过命令生成并获取图片格式的图表.
  - **训练量趋势图**: 按周或月展示总训练量 (总负重) 的变化,使用折线图.
  - **个人最佳表现 (PR) 跟踪图**: 针对特定动作 (如卧推), 展示其最大负重随时间的变化,使用折线图或条形图.
  - **身体数据趋势图 (新增)**: 展示体重、体脂率等关键身体指标随时间变化的折线图.
  - **训练部位分布图**: 统计一段时间内,胸、背、腿等不同部位的训练频率,并用饼图或环形图展示.
- **训练日历**: 通过一个命令生成一个简单的文本日历,标记出本月有训练记录的日期.

### 3.3. 健壮性与用户体验
- **智能纠错**: 对常见的输入错误进行提示. 例如, `50 kg` (带空格) 或 `50公斤` 也能被正确识别.
- **忽略非训练消息**: 机器人应能判断哪些消息是训练数据,并忽略群组内的日常闲聊.
- **多语言支持**: 未来可以扩展支持英文等其他语言的训练项目名称.
- **隐私设置**: 允许用户选择是否将自己的数据公开在群组排名中.

## 4. 技术实现初步构想

- **语言/框架**: Python + `python-telegram-bot` 库.
- **数据持久化**: SQLite 数据库,它轻量且无需独立的服务进程,非常适合此类项目初期.
- **核心逻辑**:
  - **消息处理器**: 监听所有群组消息.
  - **解析器 (Parser)**: 使用正则表达式和逻辑判断来解析消息内容.
  - **状态管理器**: 使用一个字典或缓存来存储每个用户在每个聊天中的"最后一次训练状态".
  - **命令处理器**: 响应以 `/` 开头的命令.
  - **调度器 (Scheduler)**: 用于处理定期的任务,如发送周报.

## 5. 开发路线图 (建议)

- **MVP (最小可行产品)**:
  1.  实现核心的完整格式和上下文格式解析.
  2.  完成数据到 SQLite 的存储.
  3.  实现手动的 `/summary` 命令.
- **V1.1**:
  1.  增加 `/help` 和 `/delete_last` 命令.
  2.  实现自动化的周报功能.
  3.  加入 PR 提醒.
- **未来展望**:
  1.  开发更多的数据统计和查询命令.
  2.  集成图表可视化功能.
  3.  实现别名和个性化设置.
